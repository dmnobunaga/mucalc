<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ö–∞–º–Ω–µ–π - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .version-badge {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
            display: inline-block;
        }

        .language-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .lang-btn {
            background: rgba(255,255,255,0.3);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .lang-btn:hover {
            background: rgba(255,255,255,0.5);
            transform: scale(1.05);
        }

        .lang-btn.active {
            background: rgba(255,255,255,0.8);
            color: #333;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .calculator-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .calculator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .stone-type-select {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            font-weight: 600;
        }

        .stone-type-select option {
            background: white;
            color: #333;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .results-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-top: 30px;
            display: none;
        }

        .results-title {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        .result-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .result-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-item .label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .summary-item .value {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .stones-breakdown {
            margin-top: 20px;
        }

        .stones-breakdown h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .stone-level {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .bonus-section {
            background: rgba(255,255,255,0.25);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .bonus-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .bonus-item {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .optimization-section {
            background: rgba(255,255,255,0.25);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .slot-config {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .error-message {
            background: #ff4757;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 1.1rem;
        }

        .stone-icons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .stone-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .fire { background: linear-gradient(45deg, #ff6b6b, #ff8e53); }
        .water { background: linear-gradient(45deg, #4ecdc4, #44a08d); }
        .ice { background: linear-gradient(45deg, #a8edea, #fed6e3); color: #333; }
        .wind { background: linear-gradient(45deg, #ffecd2, #fcb69f); color: #333; }

        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .result-summary {
                grid-template-columns: 1fr;
            }

            .slot-config {
                grid-template-columns: 1fr;
            }
        }

        .animation-fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button class="lang-btn active" data-lang="ru">üá∑üá∫ RU</button>
        <button class="lang-btn" data-lang="en">üá∫üá∏ EN</button>
        <button class="lang-btn" data-lang="bg">üáßüá¨ BG</button>
    </div>
    
    <div class="container">
        <div class="header">
            <h1 data-translate="title">üîÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ö–∞–º–Ω–µ–π</h1>
            <p data-translate="subtitle">–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤–∞—à–∏—Ö –∫–∞–º–Ω–µ–π —Å —É—á–µ—Ç–æ–º –±–æ–Ω—É—Å–æ–≤</p>
            <div class="version-badge" data-translate="version">‚ú® –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è - —Å –±–æ–Ω—É—Å–∞–º–∏ –∏ —Å–ª–æ—Ç–∞–º–∏</div>
            
            <div class="stone-icons">
                <div class="stone-icon fire">üî•</div>
                <div class="stone-icon water">üíß</div>
                <div class="stone-icon ice">‚ùÑÔ∏è</div>
                <div class="stone-icon wind">üí®</div>
            </div>
        </div>

        <div class="calculator-grid">
            <!-- –†–∞—Å—á–µ—Ç –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–∞–º–Ω–µ–π -->
            <div class="calculator-card">
                <h2 class="card-title" data-translate="calc_by_stones">üìä –†–∞—Å—á–µ—Ç –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–∞–º–Ω–µ–π</h2>
                <form id="stones-form">
                    <div class="form-group">
                        <label for="stone-type-1" data-translate="stone_type">–¢–∏–ø –∫–∞–º–Ω—è:</label>
                        <select id="stone-type-1" class="stone-type-select" required>
                            <option value="" data-translate="select_stone">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–∞–º–Ω—è</option>
                            <option value="Fire" data-translate-prefix="fire_option">üî• Fire (–ê—Ç–∞–∫–∞)</option>
                            <option value="Water" data-translate-prefix="water_option">üíß Water (–ó–¥–æ—Ä–æ–≤—å–µ)</option>
                            <option value="Ice" data-translate-prefix="ice_option">‚ùÑÔ∏è Ice (–ê—Ç–∞–∫–∞)</option>
                            <option value="Wind" data-translate-prefix="wind_option">üí® Wind (–ó–∞—â–∏—Ç–∞)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="base-stones" data-translate="base_stones_count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤—ã—Ö –∫–∞–º–Ω–µ–π (1 —É—Ä–æ–≤–µ–Ω—å):</label>
                        <input type="number" id="base-stones" min="0" step="1" data-translate-placeholder="enter_count" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="price-per-stone-1" data-translate="price_per_stone">–¶–µ–Ω–∞ –∑–∞ –∫–∞–º–µ–Ω—å:</label>
                        <input type="number" id="price-per-stone-1" min="0" step="0.01" data-translate-placeholder="enter_price" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É" required>
                    </div>

                    <div class="slot-config">
                        <div class="form-group">
                            <label for="equipment-slots-1" data-translate="equipment_count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:</label>
                            <input type="number" id="equipment-slots-1" min="1" max="7" value="6" placeholder="6-7">
                        </div>
                        <div class="form-group">
                            <label for="stones-per-item-1" data-translate="stones_per_item">–ö–∞–º–Ω–µ–π –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç:</label>
                            <input type="number" id="stones-per-item-1" min="1" max="3" value="3" placeholder="1-3">
                        </div>
                    </div>
                    
                    <button type="submit" class="calculate-btn" data-translate="calculate_btn">üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                </form>
            </div>

            <!-- –†–∞—Å—á–µ—Ç –ø–æ –±—é–¥–∂–µ—Ç—É -->
            <div class="calculator-card">
                <h2 class="card-title" data-translate="calc_by_budget">üí∞ –†–∞—Å—á–µ—Ç –ø–æ –±—é–¥–∂–µ—Ç—É</h2>
                <form id="budget-form">
                    <div class="form-group">
                        <label for="stone-type-2" data-translate="stone_type">–¢–∏–ø –∫–∞–º–Ω—è:</label>
                        <select id="stone-type-2" class="stone-type-select" required>
                            <option value="" data-translate="select_stone">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–∞–º–Ω—è</option>
                            <option value="Fire" data-translate-prefix="fire_option">üî• Fire (–ê—Ç–∞–∫–∞)</option>
                            <option value="Water" data-translate-prefix="water_option">üíß Water (–ó–¥–æ—Ä–æ–≤—å–µ)</option>
                            <option value="Ice" data-translate-prefix="ice_option">‚ùÑÔ∏è Ice (–ê—Ç–∞–∫–∞)</option>
                            <option value="Wind" data-translate-prefix="wind_option">üí® Wind (–ó–∞—â–∏—Ç–∞)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="budget" data-translate="available_budget">–î–æ—Å—Ç—É–ø–Ω—ã–π –±—é–¥–∂–µ—Ç:</label>
                        <input type="number" id="budget" min="0" step="0.01" data-translate-placeholder="enter_budget" placeholder="–í–≤–µ–¥–∏—Ç–µ –±—é–¥–∂–µ—Ç" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="price-per-stone-2" data-translate="price_per_stone">–¶–µ–Ω–∞ –∑–∞ –∫–∞–º–µ–Ω—å:</label>
                        <input type="number" id="price-per-stone-2" min="0" step="0.01" data-translate-placeholder="enter_price" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É" required>
                    </div>

                    <div class="slot-config">
                        <div class="form-group">
                            <label for="equipment-slots-2" data-translate="equipment_count">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:</label>
                            <input type="number" id="equipment-slots-2" min="1" max="7" value="6" placeholder="6-7">
                        </div>
                        <div class="form-group">
                            <label for="stones-per-item-2" data-translate="stones_per_item">–ö–∞–º–Ω–µ–π –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç:</label>
                            <input type="number" id="stones-per-item-2" min="1" max="3" value="3" placeholder="1-3">
                        </div>
                    </div>
                    
                    <button type="submit" class="calculate-btn" data-translate="calculate_btn2">üíé –†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
                </form>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div id="results" class="results-section">
            <h2 class="results-title" data-translate="results_title">üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞</h2>
            <div id="results-content"></div>
        </div>
    </div>

    <script>
        // –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
        const TRANSLATIONS = {
            ru: {
                title: "üîÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ö–∞–º–Ω–µ–π",
                subtitle: "–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤–∞—à–∏—Ö –∫–∞–º–Ω–µ–π —Å —É—á–µ—Ç–æ–º –±–æ–Ω—É—Å–æ–≤",
                version: "‚ú® –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è - —Å –±–æ–Ω—É—Å–∞–º–∏ –∏ —Å–ª–æ—Ç–∞–º–∏",
                calc_by_stones: "üìä –†–∞—Å—á–µ—Ç –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–∞–º–Ω–µ–π",
                calc_by_budget: "üí∞ –†–∞—Å—á–µ—Ç –ø–æ –±—é–¥–∂–µ—Ç—É",
                stone_type: "–¢–∏–ø –∫–∞–º–Ω—è:",
                select_stone: "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∫–∞–º–Ω—è",
                fire_option: "üî• Fire (–ê—Ç–∞–∫–∞)",
                water_option: "üíß Water (–ó–¥–æ—Ä–æ–≤—å–µ)",
                ice_option: "‚ùÑÔ∏è Ice (–ê—Ç–∞–∫–∞)",
                wind_option: "üí® Wind (–ó–∞—â–∏—Ç–∞)",
                base_stones_count: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–∑–æ–≤—ã—Ö –∫–∞–º–Ω–µ–π (1 —É—Ä–æ–≤–µ–Ω—å):",
                price_per_stone: "–¶–µ–Ω–∞ –∑–∞ –∫–∞–º–µ–Ω—å:",
                available_budget: "–î–æ—Å—Ç—É–ø–Ω—ã–π –±—é–¥–∂–µ—Ç:",
                equipment_count: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤:",
                stones_per_item: "–ö–∞–º–Ω–µ–π –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç:",
                calculate_btn: "üßÆ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å",
                calculate_btn2: "üíé –†–∞—Å—Å—á–∏—Ç–∞—Ç—å",
                results_title: "üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞",
                enter_count: "–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ",
                enter_price: "–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É",
                enter_budget: "–í–≤–µ–¥–∏—Ç–µ –±—é–¥–∂–µ—Ç",
                attack: "–ê—Ç–∞–∫–∞",
                health: "–ó–¥–æ—Ä–æ–≤—å–µ",
                defense: "–ó–∞—â–∏—Ç–∞",
                max_level: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å",
                total_cost: "–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å",
                base_stones: "–ë–∞–∑–æ–≤—ã—Ö –∫–∞–º–Ω–µ–π",
                available_slots: "–î–æ—Å—Ç—É–ø–Ω–æ —Å–ª–æ—Ç–æ–≤",
                level_breakdown: "üìã –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–º–Ω–µ–π –ø–æ —É—Ä–æ–≤–Ω—è–º:",
                level: "–£—Ä–æ–≤–µ–Ω—å",
                stones: "–∫–∞–º–Ω–µ–π",
                per_stone: "–∑–∞ –∫–∞–º–µ–Ω—å",
                total: "–û–±—â–∏–π",
                optimization_title: "üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞–º–Ω–µ–π",
                stones_in_slots: "–ö–∞–º–Ω–∏ –≤ —Å–ª–æ—Ç–∞—Ö:",
                total_level: "–°—É–º–º–∞—Ä–Ω—ã–π LVL:",
                bonus_level: "–ë–æ–Ω—É—Å LVL",
                no_bonus: "–ù–µ—Ç –±–æ–Ω—É—Å–∞",
                available_bonuses: "üéÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ –±–æ–Ω—É—Å—ã",
                insufficient_funds: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫–∞–º–Ω–µ–π.",
                calculating: "‚è≥ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–∞—Å—á–µ—Ç...",
                fill_fields: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ",
                positive_values: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–º–Ω–µ–π –∏ —Ü–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏",
                budget_positive: "–ë—é–¥–∂–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º, —Ü–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ –Ω—É–ª—è",
                unknown_stone: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –∫–∞–º–Ω—è:",
                calculation_error: "–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ä–∞—Å—á–µ—Ç–∞:"
            },
            en: {
                title: "üîÆ Stone Calculator",
                subtitle: "Calculate the cost and characteristics of your stones with bonuses",
                version: "‚ú® Enhanced version - with bonuses and slots",
                calc_by_stones: "üìä Calculate by stones count",
                calc_by_budget: "üí∞ Calculate by budget",
                stone_type: "Stone type:",
                select_stone: "Select stone type",
                fire_option: "üî• Fire (Attack)",
                water_option: "üíß Water (Health)",
                ice_option: "‚ùÑÔ∏è Ice (Attack)",
                wind_option: "üí® Wind (Defense)",
                base_stones_count: "Number of base stones (level 1):",
                price_per_stone: "Price per stone:",
                available_budget: "Available budget:",
                equipment_count: "Number of equipment:",
                stones_per_item: "Stones per item:",
                calculate_btn: "üßÆ Calculate",
                calculate_btn2: "üíé Calculate",
                results_title: "üìà Calculation Results",
                enter_count: "Enter count",
                enter_price: "Enter price",
                enter_budget: "Enter budget",
                attack: "Attack",
                health: "Health",
                defense: "Defense",
                max_level: "Maximum level",
                total_cost: "Total cost",
                base_stones: "Base stones",
                available_slots: "Available slots",
                level_breakdown: "üìã Stones distribution by levels:",
                level: "Level",
                stones: "stones",
                per_stone: "per stone",
                total: "Total",
                optimization_title: "üéØ Stone distribution optimization",
                stones_in_slots: "Stones in slots:",
                total_level: "Total LVL:",
                bonus_level: "Bonus LVL",
                no_bonus: "No bonus",
                available_bonuses: "üéÅ Available bonuses",
                insufficient_funds: "Insufficient funds to buy stones.",
                calculating: "‚è≥ Calculating...",
                fill_fields: "Please fill all fields correctly",
                positive_values: "Stone count and price must be positive",
                budget_positive: "Budget must be positive, price must be greater than zero",
                unknown_stone: "Unknown stone type:",
                calculation_error: "Calculation error:"
            },
            bg: {
                title: "üîÆ –ö–∞–ª–∫—É–ª–∞—Ç–æ—Ä –∑–∞ –ö–∞–º—ä–Ω–∏",
                subtitle: "–ò–∑—á–∏—Å–ª–µ—Ç–µ —Ü–µ–Ω–∞—Ç–∞ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏—Ç–µ –Ω–∞ –≤–∞—à–∏—Ç–µ –∫–∞–º—ä–Ω–∏ —Å –±–æ–Ω—É—Å–∏",
                version: "‚ú® –†–∞–∑—à–∏—Ä–µ–Ω–∞ –≤–µ—Ä—Å–∏—è - —Å –±–æ–Ω—É—Å–∏ –∏ —Å–ª–æ—Ç–æ–≤–µ",
                calc_by_stones: "üìä –ò–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –ø–æ –±—Ä–æ–π –∫–∞–º—ä–Ω–∏",
                calc_by_budget: "üí∞ –ò–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –ø–æ –±—é–¥–∂–µ—Ç",
                stone_type: "–¢–∏–ø –∫–∞–º—ä–∫:",
                select_stone: "–ò–∑–±–µ—Ä–µ—Ç–µ —Ç–∏–ø –∫–∞–º—ä–∫",
                fire_option: "üî• Fire (–ê—Ç–∞–∫–∞)",
                water_option: "üíß Water (–ó–¥—Ä–∞–≤–µ)",
                ice_option: "‚ùÑÔ∏è Ice (–ê—Ç–∞–∫–∞)",
                wind_option: "üí® Wind (–ó–∞—â–∏—Ç–∞)",
                base_stones_count: "–ë—Ä–æ–π –±–∞–∑–æ–≤–∏ –∫–∞–º—ä–Ω–∏ (–Ω–∏–≤–æ 1):",
                price_per_stone: "–¶–µ–Ω–∞ –∑–∞ –∫–∞–º—ä–∫:",
                available_budget: "–ù–∞–ª–∏—á–µ–Ω –±—é–¥–∂–µ—Ç:",
                equipment_count: "–ë—Ä–æ–π –µ–∫–∏–ø–∏—Ä–æ–≤–∫–∞:",
                stones_per_item: "–ö–∞–º—ä–Ω–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç:",
                calculate_btn: "üßÆ –ò–∑—á–∏—Å–ª–∏",
                calculate_btn2: "üíé –ò–∑—á–∏—Å–ª–∏",
                results_title: "üìà –†–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç –∏–∑—á–∏—Å–ª–µ–Ω–∏–µ—Ç–æ",
                enter_count: "–í—ä–≤–µ–¥–µ—Ç–µ –±—Ä–æ–π",
                enter_price: "–í—ä–≤–µ–¥–µ—Ç–µ —Ü–µ–Ω–∞",
                enter_budget: "–í—ä–≤–µ–¥–µ—Ç–µ –±—é–¥–∂–µ—Ç",
                attack: "–ê—Ç–∞–∫–∞",
                health: "–ó–¥—Ä–∞–≤–µ",
                defense: "–ó–∞—â–∏—Ç–∞",
                max_level: "–ú–∞–∫—Å–∏–º–∞–ª–Ω–æ –Ω–∏–≤–æ",
                total_cost: "–û–±—â–∞ —Ü–µ–Ω–∞",
                base_stones: "–ë–∞–∑–æ–≤–∏ –∫–∞–º—ä–Ω–∏",
                available_slots: "–ù–∞–ª–∏—á–Ω–∏ —Å–ª–æ—Ç–æ–≤–µ",
                level_breakdown: "üìã –†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –∫–∞–º—ä–Ω–∏—Ç–µ –ø–æ –Ω–∏–≤–∞:",
                level: "–ù–∏–≤–æ",
                stones: "–∫–∞–º—ä–Ω–∏",
                per_stone: "–∑–∞ –∫–∞–º—ä–∫",
                total: "–û–±—â–æ",
                optimization_title: "üéØ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ—Ç–æ –Ω–∞ –∫–∞–º—ä–Ω–∏—Ç–µ",
                stones_in_slots: "–ö–∞–º—ä–Ω–∏ –≤ —Å–ª–æ—Ç–æ–≤–µ:",
                total_level: "–û–±—â–æ LVL:",
                bonus_level: "–ë–æ–Ω—É—Å LVL",
                no_bonus: "–ù—è–º–∞ –±–æ–Ω—É—Å",
                available_bonuses: "üéÅ –ù–∞–ª–∏—á–Ω–∏ –±–æ–Ω—É—Å–∏",
                insufficient_funds: "–ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞ –ø–æ–∫—É–ø–∫–∞ –Ω–∞ –∫–∞–º—ä–Ω–∏.",
                calculating: "‚è≥ –ò–∑—á–∏—Å–ª—è–≤–∞ —Å–µ...",
                fill_fields: "–ú–æ–ª—è, –ø–æ–ø—ä–ª–Ω–µ—Ç–µ –≤—Å–∏—á–∫–∏ –ø–æ–ª–µ—Ç–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ",
                positive_values: "–ë—Ä–æ—è—Ç –∫–∞–º—ä–Ω–∏ –∏ —Ü–µ–Ω–∞—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–∞—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª–Ω–∏",
                budget_positive: "–ë—é–¥–∂–µ—Ç—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª–µ–Ω, —Ü–µ–Ω–∞—Ç–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ –ø–æ-–≥–æ–ª—è–º–∞ –æ—Ç –Ω—É–ª–∞",
                unknown_stone: "–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω —Ç–∏–ø –∫–∞–º—ä–∫:",
                calculation_error: "–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑—á–∏—Å–ª–µ–Ω–∏–µ—Ç–æ:"
            }
        };

        // –¢–µ–∫—É—â–∏–π —è–∑—ã–∫
        let currentLang = 'ru';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
        function changeLanguage(lang) {
            currentLang = lang;
            document.querySelector('html').setAttribute('lang', lang);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —è–∑—ã–∫ –≤ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            updatePageText();

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä –≤ localStorage
            localStorage.setItem('preferred-language', lang);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updatePageText() {
            const translations = TRANSLATIONS[currentLang];
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-translate
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[key]) {
                    element.textContent = translations[key];
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º placeholder'—ã
            document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[key]) {
                    element.setAttribute('placeholder', translations[key]);
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ select'–æ–≤
            document.querySelectorAll('[data-translate-prefix]').forEach(element => {
                const key = element.getAttribute('data-translate-prefix');
                if (translations[key]) {
                    element.textContent = translations[key];
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞
        function t(key) {
            return TRANSLATIONS[currentLang][key] || key;
        }

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –∫–∞–º–Ω–µ–π
        const STONE_TYPES = {
            'Fire': { base_stat: 'attack', base_value: 0, increment: 1 },
            'Water': { base_stat: 'health', base_value: 38, increment: 28 },
            'Ice': { base_stat: 'attack', base_value: 0, increment: 1 },
            'Wind': { base_stat: 'defense', base_value: 1, increment: 1 }
        };

        // –ë–æ–Ω—É—Å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
        const BONUS_TABLE = {
            'Water': [
                { level: 21, value: 12, bonus: '30% Restore HP' },
                { level: 42, value: 21, bonus: '30% Restore HP' },
                { level: 63, value: 31, bonus: '30% Restore HP' },
                { level: 84, value: 44, bonus: '30% Restore HP' },
                { level: 105, value: 52, bonus: '30% Restore HP' },
                { level: 126, value: 83, bonus: '30% Restore HP' },
                { level: 147, value: 143, bonus: '30% Restore HP' },
                { level: 168, value: 261, bonus: '30% Restore HP' },
                { level: 189, value: 495, bonus: '30% Restore HP' },
                { level: 210, value: 952, bonus: '30% Restore HP' },
                { level: 231, value: 1840, bonus: '30% Restore HP' },
                { level: 252, value: 3543, bonus: '30% Restore HP' }
            ],
            'Ice': [
                { level: 21, value: 5, bonus: '10% ATK Bonus' },
                { level: 42, value: 7.5, bonus: '14% ATK Bonus' },
                { level: 63, value: 10, bonus: '18% ATK Bonus' },
                { level: 84, value: 12.5, bonus: '22% ATK Bonus' },
                { level: 105, value: 15, bonus: '26% ATK Bonus' },
                { level: 126, value: 17.5, bonus: '30% ATK Bonus' },
                { level: 147, value: 20, bonus: '34% ATK Bonus' },
                { level: 168, value: 20, bonus: '38% ATK Bonus' },
                { level: 189, value: 20, bonus: '42% ATK Bonus' },
                { level: 210, value: 20, bonus: '46% ATK Bonus' },
                { level: 231, value: 20, bonus: '50% ATK Bonus' },
                { level: 252, value: 20, bonus: '54% ATK Bonus' }
            ],
            'Wind': [
                { level: 21, value: 4.18, bonus: 'PVP DMG Reduce 4.18%' },
                { level: 42, value: 4.92, bonus: 'PVP DMG Reduce 4.92%' },
                { level: 63, value: 5.79, bonus: 'PVP DMG Reduce 5.79%' },
                { level: 84, value: 6.81, bonus: 'PVP DMG Reduce 6.81%' },
                { level: 105, value: 8.01, bonus: 'PVP DMG Reduce 8.01%' },
                { level: 126, value: 9.43, bonus: 'PVP DMG Reduce 9.43%' },
                { level: 147, value: 11.09, bonus: 'PVP DMG Reduce 11.09%' },
                { level: 168, value: 13.05, bonus: 'PVP DMG Reduce 13.05%' },
                { level: 189, value: 15.35, bonus: 'PVP DMG Reduce 15.35%' },
                { level: 210, value: 18.06, bonus: 'PVP DMG Reduce 18.06%' },
                { level: 231, value: 21.25, bonus: 'PVP DMG Reduce 21.25%' },
                { level: 252, value: 25, bonus: 'PVP DMG Reduce 25%' }
            ],
            'Fire': [
                { level: 21, value: 24, bonus: '30% extra DMG 24' },
                { level: 42, value: 42, bonus: '30% extra DMG 42' },
                { level: 63, value: 63, bonus: '30% extra DMG 63' },
                { level: 84, value: 88, bonus: '30% extra DMG 88' },
                { level: 105, value: 105, bonus: '30% extra DMG 105' },
                { level: 126, value: 167, bonus: '30% extra DMG 167' },
                { level: 147, value: 286, bonus: '30% extra DMG 286' },
                { level: 168, value: 523, bonus: '30% extra DMG 523' },
                { level: 189, value: 990, bonus: '30% extra DMG 990' },
                { level: 210, value: 1904, bonus: '30% extra DMG 1904' },
                { level: 231, value: 3681, bonus: '30% extra DMG 3681' },
                { level: 252, value: 7086, bonus: '30% extra DMG 7086' }
            ]
        };

        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–∞–º–Ω–µ–π —Å –±–æ–Ω—É—Å–∞–º–∏
        class EnhancedStoneCalculator {
            static calculateStonesFromBase(stoneType, baseStones, pricePerStone, equipmentSlots, stonesPerItem) {
                if (!STONE_TYPES[stoneType]) {
                    return null;
                }

                const maxSlots = equipmentSlots * stonesPerItem;
                const stonesByLevel = { 1: baseStones };
                let currentLevel = 1;

                // –°–∏–Ω—Ç–µ–∑ –∫–∞–º–Ω–µ–π –¥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
                while (stonesByLevel[currentLevel] >= 2) {
                    const nextLevel = currentLevel + 1;
                    const stonesNextLevel = Math.floor(stonesByLevel[currentLevel] / 2);

                    if (stonesNextLevel > 0) {
                        stonesByLevel[nextLevel] = stonesNextLevel;
                        stonesByLevel[currentLevel] = stonesByLevel[currentLevel] % 2;
                    }

                    currentLevel++;
                }

                // –†–∞—Å—á–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
                const statsByLevel = {};
                const stoneConfig = STONE_TYPES[stoneType];

                for (const [level, count] of Object.entries(stonesByLevel)) {
                    if (count > 0) {
                        const statValue = stoneConfig.base_value + (parseInt(level) - 1) * stoneConfig.increment;
                        statsByLevel[level] = {
                            count: count,
                            stat_type: stoneConfig.base_stat,
                            stat_value: statValue,
                            total_stat: statValue * count
                        };
                    }
                }

                // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞–º–Ω–µ–π –ø–æ —Å–ª–æ—Ç–∞–º
                const optimization = this.optimizeStoneDistribution(stonesByLevel, stoneType, maxSlots);

                const totalCost = baseStones * pricePerStone;
                const maxLevel = Math.max(...Object.keys(stonesByLevel).map(Number));

                return {
                    stone_type: stoneType,
                    base_stones: baseStones,
                    price_per_stone: pricePerStone,
                    total_cost: totalCost,
                    max_level: maxLevel,
                    stones_by_level: stonesByLevel,
                    stats_by_level: statsByLevel,
                    optimization: optimization,
                    equipment_slots: equipmentSlots,
                    stones_per_item: stonesPerItem,
                    max_slots: maxSlots
                };
            }

            static calculateStonesFromBudget(stoneType, budget, pricePerStone, equipmentSlots, stonesPerItem) {
                if (!STONE_TYPES[stoneType]) {
                    return null;
                }

                const baseStones = Math.floor(budget / pricePerStone);

                if (baseStones === 0) {
                    return {
                        stone_type: stoneType,
                        budget: budget,
                        price_per_stone: pricePerStone,
                        base_stones: 0,
                        max_level: 0,
                        stones_by_level: {},
                        stats_by_level: {},
                        optimization: { configurations: [], best_bonus: null },
                        equipment_slots: equipmentSlots,
                        stones_per_item: stonesPerItem,
                        max_slots: equipmentSlots * stonesPerItem
                    };
                }

                return this.calculateStonesFromBase(stoneType, baseStones, pricePerStone, equipmentSlots, stonesPerItem);
            }

            static optimizeStoneDistribution(stonesByLevel, stoneType, maxSlots) {
                const configurations = [];
                const bonusTable = BONUS_TABLE[stoneType] || [];

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞–º–Ω–µ–π
                const stones = [];
                for (const [level, count] of Object.entries(stonesByLevel)) {
                    for (let i = 0; i < count; i++) {
                        stones.push(parseInt(level));
                    }
                }

                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞–º–Ω–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é —É—Ä–æ–≤–Ω—è –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤—ã—Å–æ–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π
                stones.sort((a, b) => b - a);

                if (stones.length === 0) {
                    return { configurations: [], best_bonus: null };
                }

                // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 1: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∫–∞–º–Ω–∏ –≤ —Å–ª–æ—Ç–∞—Ö
                const config1 = stones.slice(0, maxSlots);
                const totalLevel1 = config1.reduce((sum, level) => sum + level, 0);
                const bonus1 = this.getBonusForLevel(totalLevel1, bonusTable);

                configurations.push({
                    name: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∫–∞–º–Ω–∏ –≤ —Å–ª–æ—Ç–∞—Ö',
                    stones: config1,
                    total_level: totalLevel1,
                    bonus: bonus1,
                    unused_stones: stones.slice(maxSlots)
                });

                // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ –±–æ–Ω—É—Å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏
                let bestConfig = config1;
                let bestBonus = bonus1;

                for (const bonusThreshold of bonusTable) {
                    const config = this.findOptimalConfigForThreshold(stones, bonusThreshold.level, maxSlots);
                    if (config && config.total_level >= bonusThreshold.level) {
                        const bonus = this.getBonusForLevel(config.total_level, bonusTable);
                        configurations.push({
                            name: `–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ LVL ${bonusThreshold.level}`,
                            stones: config.stones,
                            total_level: config.total_level,
                            bonus: bonus,
                            unused_stones: config.unused_stones
                        });

                        if (bonus && (!bestBonus || this.compareBonuses(bonus, bestBonus) > 0)) {
                            bestConfig = config.stones;
                            bestBonus = bonus;
                        }
                    }
                }

                return {
                    configurations: configurations,
                    best_bonus: bestBonus
                };
            }

            static findOptimalConfigForThreshold(stones, targetLevel, maxSlots) {
                // –ü—Ä–æ—Å—Ç–∞—è –∂–∞–¥–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: –±–µ—Ä–µ–º –∫–∞–º–Ω–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ–º —Ü–µ–ª–µ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
                const config = [];
                let currentLevel = 0;
                const remaining = [...stones];

                for (let i = 0; i < remaining.length && config.length < maxSlots; i++) {
                    if (currentLevel + remaining[i] <= targetLevel + 10) { // –Ω–µ–±–æ–ª—å—à–æ–π –±—É—Ñ–µ—Ä
                        config.push(remaining[i]);
                        currentLevel += remaining[i];
                        remaining.splice(i, 1);
                        i--;
                    }
                }

                return {
                    stones: config,
                    total_level: currentLevel,
                    unused_stones: remaining
                };
            }

            static getBonusForLevel(totalLevel, bonusTable) {
                let bestBonus = null;
                for (const bonus of bonusTable) {
                    if (totalLevel >= bonus.level) {
                        bestBonus = bonus;
                    } else {
                        break;
                    }
                }
                return bestBonus;
            }

            static compareBonuses(bonus1, bonus2) {
                if (!bonus1 && !bonus2) return 0;
                if (!bonus1) return -1;
                if (!bonus2) return 1;
                return bonus1.level - bonus2.level;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('DOMContentLoaded', function() {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —è–∑—ã–∫
            const savedLang = localStorage.getItem('preferred-language') || 'ru';
            changeLanguage(savedLang);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.dataset.lang;
                    changeLanguage(lang);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã —Ä–∞—Å—á–µ—Ç–∞ –ø–æ –∫–∞–º–Ω—è–º
            document.getElementById('stones-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const stoneType = document.getElementById('stone-type-1').value;
                const baseStones = parseInt(document.getElementById('base-stones').value);
                const pricePerStone = parseFloat(document.getElementById('price-per-stone-1').value);
                const equipmentSlots = parseInt(document.getElementById('equipment-slots-1').value) || 6;
                const stonesPerItem = parseInt(document.getElementById('stones-per-item-1').value) || 3;
                
                if (!stoneType || isNaN(baseStones) || isNaN(pricePerStone)) {
                    showError(t('fill_fields'));
                    return;
                }

                if (baseStones < 0 || pricePerStone < 0) {
                    showError(t('positive_values'));
                    return;
                }
                
                calculateFromStones(stoneType, baseStones, pricePerStone, equipmentSlots, stonesPerItem);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã —Ä–∞—Å—á–µ—Ç–∞ –ø–æ –±—é–¥–∂–µ—Ç—É
            document.getElementById('budget-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const stoneType = document.getElementById('stone-type-2').value;
                const budget = parseFloat(document.getElementById('budget').value);
                const pricePerStone = parseFloat(document.getElementById('price-per-stone-2').value);
                const equipmentSlots = parseInt(document.getElementById('equipment-slots-2').value) || 6;
                const stonesPerItem = parseInt(document.getElementById('stones-per-item-2').value) || 3;
                
                if (!stoneType || isNaN(budget) || isNaN(pricePerStone)) {
                    showError(t('fill_fields'));
                    return;
                }

                if (budget < 0 || pricePerStone <= 0) {
                    showError(t('budget_positive'));
                    return;
                }
                
                calculateFromBudget(stoneType, budget, pricePerStone, equipmentSlots, stonesPerItem);
            });
        });

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫–∞–º–Ω–µ–π
        function calculateFromStones(stoneType, baseStones, pricePerStone, equipmentSlots, stonesPerItem) {
            showLoading();
            
            try {
                const result = EnhancedStoneCalculator.calculateStonesFromBase(stoneType, baseStones, pricePerStone, equipmentSlots, stonesPerItem);
                
                if (result === null) {
                    showError(t('unknown_stone') + ' ' + stoneType);
                    return;
                }
                
                displayResults(result, 'stones');
            } catch (error) {
                showError(t('calculation_error') + ' ' + error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á–µ—Ç–∞ –ø–æ –±—é–¥–∂–µ—Ç—É
        function calculateFromBudget(stoneType, budget, pricePerStone, equipmentSlots, stonesPerItem) {
            showLoading();
            
            try {
                const result = EnhancedStoneCalculator.calculateStonesFromBudget(stoneType, budget, pricePerStone, equipmentSlots, stonesPerItem);
                
                if (result === null) {
                    showError(t('unknown_stone') + ' ' + stoneType);
                    return;
                }
                
                displayResults(result, 'budget');
            } catch (error) {
                showError(t('calculation_error') + ' ' + error.message);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function displayResults(result, calculationType) {
            const resultsDiv = document.getElementById('results');
            const resultsContent = document.getElementById('results-content');
            
            const stoneEmoji = {
                'Fire': 'üî•',
                'Water': 'üíß',
                'Ice': '‚ùÑÔ∏è',
                'Wind': 'üí®'
            };
            
            let html = `
                <div class="result-card animation-fade-in">
                    <h3>${stoneEmoji[result.stone_type]} ${result.stone_type}</h3>
                    
                    <div class="result-summary">
                        <div class="summary-item">
                            <div class="label">${t('max_level')}</div>
                            <div class="value">${result.max_level}</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">${t('total_cost')}</div>
                            <div class="value">${result.total_cost || result.budget || 0}</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">${t('base_stones')}</div>
                            <div class="value">${result.base_stones}</div>
                        </div>
                        <div class="summary-item">
                            <div class="label">${t('available_slots')}</div>
                            <div class="value">${result.max_slots}</div>
                        </div>
                    </div>
            `;
            
            if (Object.keys(result.stats_by_level).length > 0) {
                html += `
                    <div class="stones-breakdown">
                        <h4>${t('level_breakdown')}</h4>
                `;
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º —É—Ä–æ–≤–Ω–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
                const sortedLevels = Object.keys(result.stats_by_level).sort((a, b) => parseInt(a) - parseInt(b));
                
                for (const level of sortedLevels) {
                    const stats = result.stats_by_level[level];
                    html += `
                        <div class="stone-level">
                            <div><strong>${t('level')} ${level}:</strong> ${stats.count} ${t('stones')}</div>
                            <div><strong>${t(stats.stat_type)}:</strong> ${stats.stat_value} ${t('per_stone')}</div>
                            <div><strong>${t('total')} ${t(stats.stat_type)}:</strong> ${stats.total_stat}</div>
                        </div>
                    `;
                }
                
                html += `</div>`;
                
                // –ü–æ–¥—Å—á–µ—Ç –æ–±—â–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
                let totalStats = 0;
                let statType = '';
                for (const level in result.stats_by_level) {
                    totalStats += result.stats_by_level[level].total_stat;
                    statType = result.stats_by_level[level].stat_type;
                }
                
                html += `
                    <div class="summary-item" style="margin-top: 20px; background: rgba(255,255,255,0.3);">
                        <div class="label">${t('total')} ${t(statType)}</div>
                        <div class="value" style="font-size: 1.5rem;">${totalStats}</div>
                    </div>
                `;

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                if (result.optimization && result.optimization.configurations.length > 0) {
                    html += `
                        <div class="optimization-section">
                            <div class="bonus-title">${t('optimization_title')}</div>
                    `;

                    for (const config of result.optimization.configurations) {
                        html += `
                            <div class="bonus-item">
                                <div>
                                    <strong>${config.name}</strong><br>
                                    ${t('stones_in_slots')} [${config.stones.join(', ')}]<br>
                                    ${t('total_level')} ${config.total_level}
                                </div>
                                <div>
                                    ${config.bonus ? `<strong>${t('bonus_level')} ${config.bonus.level}:</strong><br>${config.bonus.bonus}` : t('no_bonus')}
                                </div>
                            </div>
                        `;
                    }

                    html += `</div>`;
                }

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤
                const bonusTable = BONUS_TABLE[result.stone_type];
                if (bonusTable && bonusTable.length > 0) {
                    html += `
                        <div class="bonus-section">
                            <div class="bonus-title">${t('available_bonuses')}</div>
                    `;

                    for (const bonus of bonusTable.slice(0, 6)) { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 6 –±–æ–Ω—É—Å–æ–≤
                        html += `
                            <div class="bonus-item">
                                <div><strong>LVL ${bonus.level}</strong></div>
                                <div>${bonus.bonus}${bonus.value > 0 ? ` (+${bonus.value})` : ''}</div>
                            </div>
                        `;
                    }

                    html += `</div>`;
                }
            } else {
                html += `<p style="text-align: center; margin-top: 20px;">${t('insufficient_funds')}</p>`;
            }
            
            html += `</div>`;
            
            resultsContent.innerHTML = html;
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
        function showLoading() {
            const resultsDiv = document.getElementById('results');
            const resultsContent = document.getElementById('results-content');
            
            resultsContent.innerHTML = `<div class="loading">${t('calculating')}</div>`;
            resultsDiv.style.display = 'block';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            const resultsDiv = document.getElementById('results');
            const resultsContent = document.getElementById('results-content');
            
            resultsContent.innerHTML = `<div class="error-message animation-fade-in">‚ùå ${message}</div>`;
            resultsDiv.style.display = 'block';
        }
    </script>
</body>
</html>